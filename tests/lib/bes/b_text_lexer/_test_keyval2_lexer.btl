#BTL
#
# Key Value pair lexer
#
lexer
  name: keyval
  description: A Key Value pair lexer
  version: 2.0
  start_state: s_expecting_key
  end_state: s_done

tokens
  t_done
    type_hint: done
  t_equal
  t_key
  t_line_break
    type_hint: line_break
  t_space
  t_value

errors
  unexpected_char: In state {state} unexpected character {char} instead of key

chars
  c_keyval_key_first: c_underscore | c_alpha
  c_keyval_key: c_keyval_key_first | c_numeric

states

  s_expecting_key
    c_eos: s_done
      yield t_done
    c_nl: s_expecting_key
      yield t_line_break
    c_ws: s_before_key_space
      buffer write
#      yield t_space 
    c_keyval_key_first: s_key
      buffer write
    default: s_expecting_key_error
      raise unexpected_char

  s_before_key_space
    c_ws: s_before_key_space
      buffer write
    c_nl: s_expecting_key
      yield t_space
      buffer reset
      yield t_line_break
    c_keyval_key_first: s_key
      yield t_space
      buffer reset
      buffer write
    default: s_expecting_key_error
      raise unexpected_char
      
  s_expecting_key_error
    default: s_done
    
  s_key
    c_keyval_key: s_key
      buffer write
    c_equal: s_value
      yield t_key
      buffer reset
      buffer write
      yield t_equal
      buffer reset
    c_eos: s_done
      yield t_key
      buffer reset
      yield t_done
      
  s_value
    c_nl: s_expecting_key
      yield t_value
      buffer reset
      yield t_line_break
    c_eos: s_done
      yield t_value
      buffer reset
      yield t_done
    default: s_value
      buffer write
      
  s_done
